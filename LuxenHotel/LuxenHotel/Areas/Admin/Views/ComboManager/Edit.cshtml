@model LuxenHotel.Models.ViewModels.Booking.ComboViewModel
@using System.Linq
@using LuxenHotel.Models.ViewModels.Booking

@{
    ViewData["Title"] = ViewBag.PageTitle ?? "Edit Combo";
    var accommodationServices = ViewBag.AccommodationServices as List<ServiceViewModel> ?? new List<ServiceViewModel>();
}

<div class="container mt-5">
    <h2>@ViewData["Title"]</h2>

    <!-- Display error or success messages -->
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <form asp-action="Edit" method="post">
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="CreatedAt" />

        <div class="mb-3">
            <label asp-for="Name" class="form-label"></label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Price" class="form-label"></label>
            <input asp-for="Price" class="form-control" type="number" />
            <span asp-validation-for="Price" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Description" class="form-label"></label>
            <textarea asp-for="Description" class="form-control" rows="4"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="AccommodationId" class="form-label">Accommodation</label>
            <select asp-for="AccommodationId" class="form-select"
                asp-items="@(new SelectList(ViewBag.Accommodations, "Id", "Name"))">
                <option value="">Select an accommodation</option>
            </select>
            <span asp-validation-for="AccommodationId" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="Status" class="form-label">Status</label>
            <select asp-for="Status" class="form-select">
                <option value="@LuxenHotel.Models.Entities.Booking.Combo.ComboStatus.Published">Published</option>
                <option value="@LuxenHotel.Models.Entities.Booking.Combo.ComboStatus.Unpublished">Draft</option>
            </select>
            <span asp-validation-for="Status" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label">Services</label>
            <div class="form-check-container">
                @if (accommodationServices.Any())
                {
                    foreach (var service in accommodationServices)
                    {
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="SelectedServiceIds" value="@service.Id"
                                @(Model.SelectedServiceIds.Contains(service.Id) ? "checked" : "") />
                            <label class="form-check-label">@service.Name (Price: @service.Price)</label>
                        </div>
                    }
                }
                else
                {
                    <p>No services available for this accommodation.</p>
                }
            </div>
            <span asp-validation-for="SelectedServiceIds" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}